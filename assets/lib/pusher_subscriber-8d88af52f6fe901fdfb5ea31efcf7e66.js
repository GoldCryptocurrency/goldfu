(function(){var AccountHandler,DepositAddressHandler,DepositHandler,EventHandler,MemberHandler,PusherSubscriber,WithdrawHandler,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};PusherSubscriber=function(){function PusherSubscriber(){this.subscribeChannels=__bind(this.subscribeChannels,this);var pusher_key;pusher_key=$("meta[name=pusher]").attr("content"),this.socket=window.pusher,this.channels=[],this.subscribeChannels(gon.current_user.sn)}return PusherSubscriber.prototype.release=function(){return this.socket.disconnect(),this.channels=[]},PusherSubscriber.prototype.subscribeChannels=function(user_sn){return this.subscribeUserChannel(user_sn)},PusherSubscriber.prototype.subscribeUserChannel=function(user_sn){var channel,self;return channel=this.socket.subscribe("private-"+user_sn),self=this,channel.bind("pusher:subscription_succeeded",function(){return console.log("Pusher bind member channel successfully"),new MemberHandler(channel),new AccountHandler(channel),new DepositHandler(channel),new WithdrawHandler(channel),new DepositAddressHandler(channel)})},PusherSubscriber}(),EventHandler=function(){function EventHandler(channel,event){this.destroy=__bind(this.destroy,this),this.update=__bind(this.update,this),this.create=__bind(this.create,this),this.processWithoutAjax=__bind(this.processWithoutAjax,this),this.process=__bind(this.process,this),this.channel=channel,this.channel.bind(event,this.processWithoutAjax)}return EventHandler.prototype.process=function(msg){switch(msg.type){case"create":return this.create(msg.attributes);case"update":return this.update(msg.id,msg.attributes);case"destroy":return this.destroy(msg.id,msg.attributes);default:throw"Unknown type:"+type}},EventHandler.prototype.processWithoutAjax=function(){var args;return args=arguments,PeatioModel.Ajax.disable(function(_this){return function(){return _this.process.apply(_this,args)}}(this))},EventHandler.prototype.create=function(){},EventHandler.prototype.update=function(){},EventHandler.prototype.destroy=function(){},EventHandler}(),MemberHandler=function(_super){function MemberHandler(channel){MemberHandler.__super__.constructor.call(this,channel,"members")}return __extends(MemberHandler,_super),MemberHandler}(EventHandler),AccountHandler=function(_super){function AccountHandler(channel){this.update=__bind(this.update,this),AccountHandler.__super__.constructor.call(this,channel,"accounts")}return __extends(AccountHandler,_super),AccountHandler.prototype.update=function(id,attributes){var account;return account=Account.findBy("id",id).updateAttributes(attributes)},AccountHandler}(EventHandler),DepositHandler=function(_super){function DepositHandler(channel){this.update=__bind(this.update,this),this.create=__bind(this.create,this),DepositHandler.__super__.constructor.call(this,channel,"deposits")}return __extends(DepositHandler,_super),DepositHandler.prototype.create=function(attributes){return Deposit.create(attributes),$.publish("deposit:create")},DepositHandler.prototype.update=function(id,attributes){return Deposit.findBy("id",id).updateAttributes(attributes)},DepositHandler}(EventHandler),WithdrawHandler=function(_super){function WithdrawHandler(channel){this.destroy=__bind(this.destroy,this),this.update=__bind(this.update,this),this.create=__bind(this.create,this),WithdrawHandler.__super__.constructor.call(this,channel,"withdraws")}return __extends(WithdrawHandler,_super),WithdrawHandler.prototype.create=function(attributes){return Withdraw.create(attributes)},WithdrawHandler.prototype.update=function(id,attributes){return Withdraw.findBy("id",id).updateAttributes(attributes)},WithdrawHandler.prototype.destroy=function(id){return Withdraw.destroy(id)},WithdrawHandler}(EventHandler),DepositAddressHandler=function(_super){function DepositAddressHandler(channel){this.create=__bind(this.create,this),DepositAddressHandler.__super__.constructor.call(this,channel,"deposit_address")}return __extends(DepositAddressHandler,_super),DepositAddressHandler.prototype.create=function(attributes){var account;return account=Account.findBy("id",attributes.account_id),account.deposit_address=attributes.deposit_address,account.save(),$.publish("deposit_address:create",attributes.deposit_address)},DepositAddressHandler}(EventHandler),window.PusherSubscriber=PusherSubscriber}).call(this);