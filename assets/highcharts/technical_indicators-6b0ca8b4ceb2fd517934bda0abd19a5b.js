!function(H){function calcMACD(xData,yData){var shortEMA,longEMA,signalPeriod=9,MACD=[],xMACD=[],yMACD=[],signalLine=[],histogram=[];shortEMA=EMA(xData,yData,12),longEMA=EMA(xData,yData,26);for(var i=0;i<shortEMA.length;i++)null==longEMA[i][1]?MACD.push([xData[i],null]):MACD.push([xData[i],shortEMA[i][1]-longEMA[i][1]]);for(var i=0;i<MACD.length;i++)xMACD.push(MACD[i][0]),yMACD.push(MACD[i][1]);signalLine=EMA(xMACD,yMACD,signalPeriod);for(var i=0;i<MACD.length;i++)null==MACD[i][1]?histogram.push([MACD[i][0],null]):histogram.push([MACD[i][0],MACD[i][1]-signalLine[i][1]]);return[MACD,signalLine,histogram]}function linear(xData,yData){var step1,lineData=[],step2=0,step3=0,step3a=0,step3b=0,step4=0,step5=0,step5a=0,step6=0,step7=0,step8=0,step9=0;step1=xData.length;for(var i=0;step1>i;i++)step2+=xData[i]*yData[i],step3a+=xData[i],step3b+=yData[i],step4+=Math.pow(xData[i],2),step5a+=xData[i],step7+=yData[i];return step2=step1*step2,step3=step3a*step3b,step4=step1*step4,step5=Math.pow(step5a,2),step6=(step2-step3)/(step4-step5),step8=step6*step5a,step9=(step7-step8)/step1,lineData.push([xData[0],yData[0]]),step10=step6*xData[step1-1]+step9,lineData.push([xData[step1-1],step10]),lineData}function MA(xData,yData,periods){for(var maLine=[],periodArr=[],length=yData.length,i=0;length>i;i++)periodArr.push(yData[i]),i>=periods?(maLine.push([xData[i],arrayAvg(periodArr)]),periodArr.shift()):maLine.push([xData[i],null]);return maLine}function EMA(xData,yData,periods){for(var t,ema,y=!1,n=periods,k=2/(n+1),emLine=[],periodArr=[],length=yData.length,i=(xData[0],0);length>i;i++)yData[i-1]&&periodArr.push(yData[i]),n==periodArr.length?(t=yData[i],y?(ema=t*k+y*(1-k),y=ema):y=arrayAvg(periodArr),emLine.push([xData[i],y]),periodArr.splice(0,1)):emLine.push([xData[i],null]);return emLine}function SMA(xData,yData,periods){for(var periodArr=[],smLine=[],length=yData.length,i=(xData[0],0);length>i;i++)periodArr.push(yData[i]),periods==periodArr.length?(smLine.push([xData[i],arrayAvg(periodArr)]),periodArr.splice(0,1)):smLine.push([xData[i],null]);return smLine}function arrayAvg(arr){for(var sum=0,arrLength=arr.length,i=arrLength;i--;)sum+=arr[i];return sum/arrLength}var defaultOptions=H.getOptions(),defaultPlotOptions=defaultOptions.plotOptions,seriesTypes=H.seriesTypes;defaultPlotOptions.trendline=H.merge(defaultPlotOptions.line,{marker:{enabled:!1},tooltip:{valueDecimals:2}}),seriesTypes.trendline=H.extendClass(seriesTypes.line,{type:"trendline",animate:null,requiresSorting:!1,processData:function(){var data;this.linkedParent&&(data=[].concat(this.linkedParent.options.data),this.setData(this.runAlgorithm(),!1)),H.Series.prototype.processData.call(this)},runAlgorithm:function(){var xData=this.linkedParent.xData,yData=this.linkedParent.yData,periods=this.options.periods||100,algorithm=this.options.algorithm||"linear";return this[algorithm](xData,yData,periods)},MACD:function(xData,yData,periods){return calcMACD(xData,yData,periods)[0]},signalLine:function(xData,yData,periods){return calcMACD(xData,yData,periods)[1]},SMA:function(xData,yData,periods){return SMA(xData,yData,periods)},MA:function(xData,yData,periods){return MA(xData,yData,periods)},EMA:function(xData,yData,periods){return EMA(xData,yData,periods)},linear:function(xData,yData,periods){return linear(xData,yData,periods)}}),defaultPlotOptions.histogram=H.merge(defaultPlotOptions.column,{borderWidth:0,tooltip:{valueDecimals:2}}),seriesTypes.histogram=H.extendClass(seriesTypes.column,{type:"histogram",animate:null,requiresSorting:!1,processData:function(){var data;this.linkedParent&&(data=[].concat(this.linkedParent.options.data),this.setData(this.runAlgorithm(),!1)),H.Series.prototype.processData.call(this)},runAlgorithm:function(){var xData=this.linkedParent.xData,yData=this.linkedParent.yData,periods=this.options.periods||100,algorithm=this.options.algorithm||"histogram";return this[algorithm](xData,yData,periods)},histogram:function(xData,yData,periods){return calcMACD(xData,yData,periods)[2]}})}(Highcharts);