(function(){window.MarketTradesUI=flight.component(function(){return flight.compose.mixin(this,[NotificationMixin]),this.attributes({defaultHeight:156,tradeSelector:"tr",newTradeSelector:"tr.new",allSelector:"a.all",mySelector:"a.my",allTableSelector:"table.all-trades tbody",myTableSelector:"table.my-trades tbody",newMarketTradeContent:"table.all-trades tr.new div",newMyTradeContent:"table.my-trades tr.new div",tradesLimit:80}),this.showAllTrades=function(){return this.select("mySelector").removeClass("active"),this.select("allSelector").addClass("active"),this.select("myTableSelector").hide(),this.select("allTableSelector").show()},this.showMyTrades=function(){return this.select("allSelector").removeClass("active"),this.select("mySelector").addClass("active"),this.select("allTableSelector").hide(),this.select("myTableSelector").show()},this.bufferMarketTrades=function(event,data){return this.marketTrades=this.marketTrades.concat(data.trades)},this.clearMarkers=function(table){return table.find("tr.new").removeClass("new"),table.find("tr").slice(this.attr.tradesLimit).remove()},this.notifyMyTrade=function(trade){var market,message;return market=gon.markets[trade.market],message=gon.i18n.notification.new_trade.replace(/%{kind}/g,gon.i18n[trade.kind]).replace(/%{id}/g,trade.id).replace(/%{price}/g,trade.price).replace(/%{volume}/g,trade.volume).replace(/%{base_unit}/g,market.base_unit.toUpperCase()).replace(/%{quote_unit}/g,market.quote_unit.toUpperCase()),this.notify(message)},this.isMine=function(trade){var t,_i,_len,_ref;if(0===this.myTrades.length)return!1;for(_ref=this.myTrades,_i=0,_len=_ref.length;_len>_i;_i++){if(t=_ref[_i],trade.tid===t.id)return!0;if(trade.tid>t.id)return!1}},this.handleMarketTrades=function(event,data){var el,trade,_i,_len,_ref;for(_ref=data.trades,_i=0,_len=_ref.length;_len>_i;_i++)trade=_ref[_i],this.marketTrades.unshift(trade),trade.classes="new",this.isMine(trade)&&(trade.classes+=" mine"),el=this.select("allTableSelector").prepend(JST["templates/market_trade"](trade));return this.marketTrades=this.marketTrades.slice(0,this.attr.tradesLimit),this.select("newMarketTradeContent").slideDown("slow"),setTimeout(function(_this){return function(){return _this.clearMarkers(_this.select("allTableSelector"))}}(this),900)},this.handleMyTrades=function(event,data,notify){var el,trade,_i,_len,_ref;for(null==notify&&(notify=!0),_ref=data.trades,_i=0,_len=_ref.length;_len>_i;_i++)trade=_ref[_i],trade.market===gon.market.id&&(this.myTrades.unshift(trade),trade.classes="new",el=this.select("myTableSelector").prepend(JST["templates/my_trade"](trade)),this.select("allTableSelector").find("tr#market-trade-"+trade.id).addClass("mine")),notify&&this.notifyMyTrade(trade);return this.myTrades.length>this.attr.tradesLimit&&(this.myTrades=this.myTrades.slice(0,this.attr.tradesLimit)),this.select("newMyTradeContent").slideDown("slow"),setTimeout(function(_this){return function(){return _this.clearMarkers(_this.select("myTableSelector"))}}(this),900)},this.after("initialize",function(){return this.marketTrades=[],this.myTrades=[],this.on(document,"trade::populate",function(_this){return function(event,data){return _this.handleMyTrades(event,{trades:data.trades.reverse()},!1)}}(this)),this.on(document,"trade",function(_this){return function(event,trade){return _this.handleMyTrades(event,{trades:[trade]})}}(this)),this.on(document,"market::trades",this.handleMarketTrades),this.on(this.select("allSelector"),"click",this.showAllTrades),this.on(this.select("mySelector"),"click",this.showMyTrades)})})}).call(this);