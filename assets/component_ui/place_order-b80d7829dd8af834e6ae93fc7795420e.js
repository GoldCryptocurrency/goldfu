(function(){this.PlaceOrderUI=flight.component(function(){return this.attributes({formSel:"form",successSel:".status-success",infoSel:".status-info",dangerSel:".status-danger",priceAlertSel:".hint-price-disadvantage",positionsLabelSel:".hint-positions",priceSel:"input[id$=price]",volumeSel:"input[id$=volume]",totalSel:"input[id$=total]",currentBalanceSel:"span.current-balance",submitButton:":submit"}),this.panelType=function(){switch(this.$node.attr("id")){case"bid_entry":return"bid";case"ask_entry":return"ask"}},this.cleanMsg=function(){return this.select("successSel").text(""),this.select("infoSel").text(""),this.select("dangerSel").text("")},this.resetForm=function(){return this.trigger("place_order::reset::price"),this.trigger("place_order::reset::volume"),this.trigger("place_order::reset::total"),this.priceAlertHide()},this.disableSubmit=function(){return this.select("submitButton").addClass("disabled").attr("disabled","disabled")},this.enableSubmit=function(){return this.select("submitButton").removeClass("disabled").removeAttr("disabled")},this.confirmDialogMsg=function(){var confirmType,price,sum,volume;return confirmType=this.select("submitButton").text(),price=this.select("priceSel").val(),volume=this.select("volumeSel").val(),sum=this.select("totalSel").val(),""+gon.i18n.place_order.confirm_submit+' "'+confirmType+'"?\n\n'+gon.i18n.place_order.price+": "+price+"\n"+gon.i18n.place_order.volume+": "+volume+"\n"+gon.i18n.place_order.sum+": "+sum},this.beforeSend=function(event,jqXHR){return this.disableSubmit()},this.handleSuccess=function(event,data){return this.cleanMsg(),this.select("successSel").append(JST["templates/hint_order_success"]({msg:data.message})).show(),this.resetForm(event),window.sfx_success(),this.enableSubmit()},this.handleError=function(event,data){var ef_class,json;return this.cleanMsg(),ef_class="shake shake-constant hover-stop",json=JSON.parse(data.responseText),this.select("dangerSel").append(JST["templates/hint_order_warning"]({msg:json.message})).show().addClass(ef_class).wait(500).removeClass(ef_class),window.sfx_warning(),this.enableSubmit()},this.getBalance=function(){return BigNumber(this.select("currentBalanceSel").data("balance"))},this.getLastPrice=function(){return BigNumber(gon.ticker.last)},this.allIn=function(){switch(this.panelType()){case"ask":return this.trigger("place_order::input::price",{price:this.getLastPrice()}),this.trigger("place_order::input::volume",{volume:this.getBalance()});case"bid":return this.trigger("place_order::input::price",{price:this.getLastPrice()}),this.trigger("place_order::input::total",{total:this.getBalance()})}},this.refreshBalance=function(){var balance,currency,type,_ref;return type=this.panelType(),currency=gon.market[type].currency,balance=(null!=(_ref=gon.accounts[currency])?_ref.balance:void 0)||0,this.select("currentBalanceSel").data("balance",balance),this.select("currentBalanceSel").text(formatter.fix(type,balance)),this.trigger("place_order::balance::change",{balance:BigNumber(balance)}),this.trigger("place_order::max::"+this.usedInput,{max:BigNumber(balance)})},this.updateAvailable=function(event,order){var available,node,type;return type=this.panelType(),node=this.select("currentBalanceSel"),order[this.usedInput]||(order[this.usedInput]=0),available=formatter.fix(type,this.getBalance().minus(order[this.usedInput])),BigNumber(available).equals(0)?this.select("positionsLabelSel").hide().text(gon.i18n.place_order["full_"+type]).fadeIn():this.select("positionsLabelSel").fadeOut().text(""),node.text(available)},this.priceAlertHide=function(){return this.select("priceAlertSel").fadeOut(function(){return $(this).text("")})},this.priceAlertShow=function(event,data){return this.select("priceAlertSel").hide().text(gon.i18n.place_order[data.label]).fadeIn()},this.clear=function(e){return this.resetForm(e),this.trigger("place_order::focus::price")},this.after("initialize",function(){var type;return type=this.panelType(),this.usedInput="ask"===type?"volume":"total",PlaceOrderData.attachTo(this.$node),OrderPriceUI.attachTo(this.select("priceSel"),{form:this.$node,type:type}),OrderVolumeUI.attachTo(this.select("volumeSel"),{form:this.$node,type:type}),OrderTotalUI.attachTo(this.select("totalSel"),{form:this.$node,type:type}),this.on("place_order::price_alert::hide",this.priceAlertHide),this.on("place_order::price_alert::show",this.priceAlertShow),this.on("place_order::order::updated",this.updateAvailable),this.on("place_order::clear",this.clear),this.on(document,"account::update",this.refreshBalance),this.on(this.select("formSel"),"ajax:beforeSend",this.beforeSend),this.on(this.select("formSel"),"ajax:success",this.handleSuccess),this.on(this.select("formSel"),"ajax:error",this.handleError),this.on(this.select("currentBalanceSel"),"click",this.allIn)})})}).call(this);