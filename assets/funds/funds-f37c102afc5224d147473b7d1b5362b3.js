(function(){var Account,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Account=function(_super){function Account(){return Account.__super__.constructor.apply(this,arguments)}return __extends(Account,_super),Account.configure("Account","member_id","currency","balance","locked","created_at","updated_at","in","out","deposit_address","name_text"),Account.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){return Account.create(record)})})},Account.prototype.deposit_channels=function(){return DepositChannel.findAllBy("currency",this.currency)},Account.prototype.withdraw_channels=function(){return WithdrawChannel.findAllBy("currency",this.currency)},Account.prototype.deposit_channel=function(){return DepositChannel.findBy("currency",this.currency)},Account.prototype.deposits=function(){return _.sortBy(Deposit.findAllBy("account_id",this.id),function(d){return d.id}).reverse()},Account.prototype.withdraws=function(){return _.sortBy(Withdraw.findAllBy("account_id",this.id),function(d){return d.id}).reverse()},Account.prototype.topDeposits=function(){return this.deposits().reverse().slice(0,3)},Account.prototype.topWithdraws=function(){return this.withdraws().reverse().slice(0,3)},Account}(PeatioModel.Model),window.Account=Account}).call(this),function(){var Currency,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Currency=function(_super){function Currency(){return Currency.__super__.constructor.apply(this,arguments)}return __extends(Currency,_super),Currency.configure("Currency","key","code","coin","blockchain"),Currency.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){var currency;return currency=Currency.create(record.attributes)})})},Currency}(PeatioModel.Model),window.Currency=Currency}.call(this),function(){var Deposit,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Deposit=function(_super){function Deposit(){Deposit.__super__.constructor.apply(this,arguments),this.is_submitting="submitting"===this.aasm_state}return __extends(Deposit,_super),Deposit.configure("Deposit","account_id","member_id","currency","amount","fee","fund_uid","fund_extra","txid","state","aasm_state","created_at","updated_at","done_at","type","confirmations","is_submitting","blockchain_url","txid_desc"),Deposit.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){return Deposit.create(record)})})},Deposit}(PeatioModel.Model),window.Deposit=Deposit}.call(this),function(){var DepositChannel,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};DepositChannel=function(_super){function DepositChannel(){return DepositChannel.__super__.constructor.apply(this,arguments)}return __extends(DepositChannel,_super),DepositChannel.configure("DepositChannel","key","currency","min_confirm","max_confirm","bank_accounts","resource_name"),DepositChannel.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){return DepositChannel.create(record)})})},DepositChannel.prototype.account=function(){return Account.findBy("currency",this.currency)},DepositChannel}(PeatioModel.Model),window.DepositChannel=DepositChannel}.call(this),function(){var Member,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Member=function(_super){function Member(){return Member.__super__.constructor.apply(this,arguments)}return __extends(Member,_super),Member.configure("Member","sn","display_name","created_at","updated_at","state","country_code","phone_number","name","app_activated","sms_activated"),Member.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){return Member.create(record)})})},Member}(PeatioModel.Model),window.Member=Member}.call(this),function(){var Withdraw,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};Withdraw=function(_super){function Withdraw(){Withdraw.__super__.constructor.apply(this,arguments),this.is_submitting="submitting"===this.aasm_state}return __extends(Withdraw,_super),Withdraw.configure("Withdraw","sn","account_id","member_id","currency","amount","fee","fund_uid","fund_extra","created_at","updated_at","done_at","txid","blockchain_url","aasm_state","sum","type","is_submitting"),Withdraw.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){return Withdraw.create(record)})})},Withdraw.prototype.afterScope=function(){return""+this.pathName()},Withdraw.prototype.pathName=function(){switch(this.currency){case"cny":return"banks";case"btc":return"satoshis"}},Withdraw}(PeatioModel.Model),window.Withdraw=Withdraw}.call(this),function(){var WithdrawChannel,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};WithdrawChannel=function(_super){function WithdrawChannel(){return WithdrawChannel.__super__.constructor.apply(this,arguments)}return __extends(WithdrawChannel,_super),WithdrawChannel.configure("WithdrawChannel","key","currency","resource_name"),WithdrawChannel.initData=function(records){return PeatioModel.Ajax.disable(function(){return $.each(records,function(idx,record){return WithdrawChannel.create(record)})})},WithdrawChannel.prototype.account=function(){return Account.findBy("currency",this.currency)},WithdrawChannel}(PeatioModel.Model),window.WithdrawChannel=WithdrawChannel}.call(this),function(){angular.module("precisionFilters",[]).filter("round_down",function(){return function(number){return BigNumber(number).round(5,BigNumber.ROUND_DOWN).toF(5)}})}.call(this),function(){angular.module("textFilters",[]).filter("truncate",function(){return function(text,size){return text.length>20?text.slice(0,size)+"...":text}})}.call(this),function(){angular.module("translateFilters",[]).filter("t",function(){return function(key,args){return null==args&&(args={}),I18n.t(key,args)}})}.call(this),function(){var app;$(function(){return window.pusher_subscriber=new PusherSubscriber}),Member.initData([gon.current_user]),DepositChannel.initData(gon.deposit_channels),WithdrawChannel.initData(gon.withdraw_channels),Deposit.initData(gon.deposits),Account.initData(gon.accounts),Currency.initData(gon.currencies),Withdraw.initData(gon.withdraws),window.app=app=angular.module("funds",["ui.router","ngResource","translateFilters","textFilters","precisionFilters","ngDialog"])}.call(this),function(){app.service("accountService",["$filter","$gon",function($filter,$gon){return{filterBy:function(filter){return $filter("filter")($gon.accounts,filter)},findBy:function(filter){var result;return result=this.filterBy(filter),result.length?result[0]:null}}}])}.call(this),function(){app.service("fundSourceService",["$filter","$gon","$resource","accountService",function($filter,$gon,$resource,accountService){var resource;return resource=$resource("/fund_sources/:id",{id:"@id"},{update:{method:"PUT"}}),{filterBy:function(filter){return $filter("filter")($gon.fund_sources,filter)},findBy:function(filter){var result;return result=this.filterBy(filter),result.length?result[0]:null},defaultFundSource:function(filter){var account;return account=accountService.findBy(filter),account?this.findBy({id:account.default_withdraw_fund_source}):null},create:function(data,afterCreate){return resource.save(data,function(){return function(fund_source){return $gon.fund_sources.push(fund_source),afterCreate?afterCreate(fund_source):void 0}}(this))},update:function(fund_source,afterUpdate){var account;return(account=accountService.findBy({currency:fund_source.currency}))?(account.default_withdraw_fund_source=fund_source.id,resource.update({id:fund_source.id},function(){return function(){return afterUpdate?afterUpdate():void 0}}(this))):null},remove:function(fund_source,afterRemove){return resource.remove({id:fund_source.id},function(){return function(){return $gon.fund_sources.splice($gon.fund_sources.indexOf(fund_source),1),afterRemove?afterRemove():void 0}}(this))}}}])}.call(this),function(){app.factory("$gon",["$window",function(win){return win.gon}])}.call(this),function(){app.config(["ngDialogProvider",function(ngDialogProvider){return ngDialogProvider.setDefaults({closeByDocument:!1,closeByEscape:!1,trapFocus:!1,cache:!1})}])}.call(this),function(){app.directive("accounts",function(){return{restrict:"E",templateUrl:"/templates/funds/accounts.html",scope:{localValue:"=accounts"},controller:function($scope,$state){var ctrl;return ctrl=this,this.state=$state,""===window.location.hash&&this.state.transitionTo("deposits.currency",{currency:Account.first().currency}),$scope.accounts=Account.all(),this.selectedCurrency=window.location.hash.split("/")[2]||Account.first().currency,this.currentAction=window.location.hash.split("/")[1]||"deposits",$scope.currency=this.selectedCurrency,this.isSelected=function(currency){return this.selectedCurrency===currency},this.isDeposit=function(){return"deposits"===this.currentAction},this.isWithdraw=function(){return"withdraws"===this.currentAction},this.deposit=function(account){return ctrl.state.transitionTo("deposits.currency",{currency:account.currency}),ctrl.selectedCurrency=account.currency,ctrl.currentAction="deposits"},this.withdraw=function(account){return ctrl.state.transitionTo("withdraws.currency",{currency:account.currency}),ctrl.selectedCurrency=account.currency,ctrl.currentAction="withdraws"},(this.event=function(){return Account.bind("create update destroy",function(){return $scope.$apply()})})()},controllerAs:"accountsCtrl"}})}.call(this),function(){app.controller("DepositHistoryController",function($scope,$stateParams,$http){var ctrl;return ctrl=this,$scope.predicate="-id",this.currency=$stateParams.currency,this.account=Account.findBy("currency",this.currency),this.deposits=this.account.deposits().slice(0,3),this.newRecord=function(deposit){return"submitting"===deposit.aasm_state?!0:!1},this.noDeposit=function(){return 0===this.deposits.length},this.refresh=function(){return this.deposits=this.account.deposits().slice(0,3),$scope.$apply()},this.cancelDeposit=function(deposit){var deposit_channel;return deposit_channel=DepositChannel.findBy("currency",deposit.currency),$http["delete"]("/deposits/"+deposit_channel.resource_name+"/"+deposit.id).error(function(responseText){return $.publish("flash",{message:responseText})})},this.canCancel=function(state){return["submitting"].indexOf(state)>-1},(this.event=function(){return Deposit.bind("create update destroy",function(){return ctrl.refresh()})})()})}.call(this),function(){app.controller("DepositsController",["$scope","$stateParams","$http","$filter","$gon","ngDialog",function($scope,$stateParams,$http,$filter,$gon,ngDialog){var current_user;return this.deposit={},$scope.currency=$stateParams.currency,$scope.current_user=current_user=$gon.current_user,$scope.name=current_user.name,$scope.fund_sources=$gon.fund_sources,$scope.account=Account.findBy("currency",$scope.currency),$scope.deposit_channel=DepositChannel.findBy("currency",$scope.currency),this.createDeposit=function(currency){var account,data,depositCtrl,deposit_channel;return depositCtrl=this,deposit_channel=DepositChannel.findBy("currency",currency),account=deposit_channel.account(),data={account_id:account.id,member_id:current_user.id,currency:currency,amount:this.deposit.amount,fund_source:this.deposit.fund_source},$(".form-submit > input").attr("disabled","disabled"),$http.post("/deposits/"+deposit_channel.resource_name,{deposit:data}).error(function(responseText){return $.publish("flash",{message:responseText})})["finally"](function(){return depositCtrl.deposit={},$(".form-submit > input").removeAttr("disabled")})},$scope.openFundSourceManagerPanel=function(){return ngDialog.open({template:"/templates/fund_sources/bank.html",controller:"FundSourcesController",className:"ngdialog-theme-default custom-width",data:{currency:$scope.currency}})},$scope.genAddress=function(resource_name){return ngDialog.openConfirm({template:"/templates/shared/confirm_dialog.html",data:{content:$filter("t")("funds.deposit_coin.confirm_gen_new_address")}}).then(function(){return $("a#new_address").html("..."),$("a#new_address").attr("disabled","disabled"),$http.post("/deposits/"+resource_name+"/gen_address",{}).error(function(responseText){return $.publish("flash",{message:responseText})})["finally"](function(){return $("a#new_address").html(I18n.t("funds.deposit_coin.new_address")),$("a#new_address").attr("disabled","disabled")})})},$scope.$watch(function(){return $scope.account.deposit_address},function(){return setTimeout(function(){return $.publish("deposit_address:create")},1e3)})}])}.call(this),function(){app.controller("FundSourcesController",["$scope","$gon","fundSourceService",function($scope,$gon,fundSourceService){var currency;return $scope.banks=$gon.banks,$scope.currency=currency=$scope.ngDialogData.currency,$scope.fund_sources=function(){return fundSourceService.filterBy({currency:currency})},$scope.defaultFundSource=function(){return fundSourceService.defaultFundSource({currency:currency})},$scope.add=function(){var data,extra,uid;return angular.isString($scope.uid)&&(uid=$scope.uid.trim()),angular.isString($scope.extra)&&(extra=$scope.extra.trim()),uid&&extra?(data={uid:uid,extra:extra,currency:currency},fundSourceService.create(data,function(){return $scope.uid="",currency!==$gon.fiat_currency?$scope.extra="":void 0})):void 0},$scope.remove=function(fund_source){return fundSourceService.remove(fund_source)},$scope.makeDefault=function(fund_source){return fundSourceService.update(fund_source)}}])}.call(this),function(){app.controller("WithdrawHistoryController",function($scope,$stateParams,$http){var ctrl;return ctrl=this,$scope.predicate="-id",this.currency=$stateParams.currency,this.account=Account.findBy("currency",this.currency),this.withdraws=this.account.withdraws().slice(0,3),this.newRecord=function(withdraw){return"submitting"===withdraw.aasm_state?!0:!1},this.noWithdraw=function(){return 0===this.withdraws.length},this.refresh=function(){return ctrl.withdraws=ctrl.account.withdraws().slice(0,3),$scope.$apply()},this.canCancel=function(state){return["submitting","submitted","accepted"].indexOf(state)>-1},this.cancelWithdraw=function(withdraw){var withdraw_channel;return withdraw_channel=WithdrawChannel.findBy("currency",withdraw.currency),$http["delete"]("/withdraws/"+withdraw_channel.resource_name+"/"+withdraw.id).error(function(responseText){return $.publish("flash",{message:responseText})})},(this.event=function(){return Withdraw.bind("create update destroy",function(){return ctrl.refresh()})})()})}.call(this),function(){app.controller("WithdrawsController",["$scope","$stateParams","$http","$gon","fundSourceService","ngDialog",function($scope,$stateParams,$http,$gon,fundSourceService,ngDialog){var currency,current_user,defaultFundSource,fund_sources,_selectedFundSourceId,_selectedFundSourceIdInList;return _selectedFundSourceId=null,_selectedFundSourceIdInList=function(list){var fs,_i,_len;for(_i=0,_len=list.length;_len>_i;_i++)if(fs=list[_i],fs.id===_selectedFundSourceId)return!0;return!1},$scope.currency=currency=$stateParams.currency,$scope.current_user=current_user=$gon.current_user,$scope.name=current_user.name,$scope.account=Account.findBy("currency",$scope.currency),$scope.balance=$scope.account.balance,$scope.withdraw_channel=WithdrawChannel.findBy("currency",$scope.currency),$scope.selected_fund_source=function(newId){return angular.isDefined(newId)?_selectedFundSourceId=newId:_selectedFundSourceId},$scope.fund_sources=function(){var fund_sources;return fund_sources=fundSourceService.filterBy({currency:currency}),_selectedFundSourceId&&_selectedFundSourceIdInList(fund_sources)||fund_sources.length&&$scope.selected_fund_source(fund_sources[0].id),fund_sources},defaultFundSource=fundSourceService.defaultFundSource({currency:currency}),defaultFundSource?_selectedFundSourceId=defaultFundSource.id:(fund_sources=$scope.fund_sources(),fund_sources.length&&(_selectedFundSourceId=fund_sources[0].id)),$scope.$watch(function(){return fundSourceService.defaultFundSource({currency:currency})},function(defaultFundSource){return defaultFundSource?$scope.selected_fund_source(defaultFundSource.id):void 0}),this.withdraw={},this.createWithdraw=function(currency){var account,data,otp,type,withdraw_channel;return withdraw_channel=WithdrawChannel.findBy("currency",currency),account=withdraw_channel.account(),data={withdraw:{member_id:current_user.id,currency:currency,sum:this.withdraw.sum,fund_source:_selectedFundSourceId}},(current_user.app_activated||current_user.sms_activated)&&(type=$(".two_factor_auth_type").val(),otp=$("#two_factor_otp").val(),data.two_factor={type:type,otp:otp},data.captcha=$("#captcha").val(),data.captcha_key=$("#captcha_key").val()),$(".form-submit > input").attr("disabled","disabled"),$http.post("/withdraws/"+withdraw_channel.resource_name,data).error(function(responseText){return $.publish("flash",{message:responseText})})["finally"](function(_this){return function(){return _this.withdraw={},$(".form-submit > input").removeAttr("disabled"),$.publish("withdraw:form:submitted")}}(this))},this.withdrawAll=function(){return this.withdraw.sum=Number($scope.account.balance)},$scope.openFundSourceManagerPanel=function(){var className,template;return $scope.currency===$gon.fiat_currency?(template="/templates/fund_sources/bank.html",className="ngdialog-theme-default custom-width"):(template="/templates/fund_sources/coin.html",className="ngdialog-theme-default custom-width coin"),ngDialog.open({template:template,controller:"FundSourcesController",className:className,data:{currency:$scope.currency}})},$scope.sms_and_app_activated=function(){return current_user.app_activated&&current_user.sms_activated},$scope.only_app_activated=function(){return current_user.app_activated&&!current_user.sms_activated},$scope.only_sms_activated=function(){return current_user.sms_activated&&!current_user.app_activated},$scope.$watch(function(){return $scope.currency},function(){return setTimeout(function(){return $.publish("two_factor_init")},100)})}])}.call(this),function(){app.config(function($stateProvider){return $stateProvider.state("deposits",{url:"/deposits",templateUrl:"/templates/funds/deposits.html"}).state("deposits.currency",{url:"/:currency",templateUrl:"/templates/funds/deposit.html",controller:"DepositsController",currentAction:"deposit"}).state("withdraws",{url:"/withdraws",templateUrl:"/templates/funds/withdraws.html"}).state("withdraws.currency",{url:"/:currency",templateUrl:"/templates/funds/withdraw.html",controller:"WithdrawsController",currentAction:"withdraw"})})}.call(this),function(){$(window).load(function(){return $.subscribe("deposit_address:create",function(){return $("[data-clipboard-text], [data-clipboard-target]").each(function(){var placement,zero;return zero=new ZeroClipboard($(this),{forceHandCursor:!0}),zero.on("complete",function(){return $(zero.htmlBridge).attr("title",gon.clipboard.done).tooltip("fixTitle").tooltip("show")}),zero.on("mouseout",function(){return $(zero.htmlBridge).attr("title",gon.clipboard.click).tooltip("fixTitle")}),placement=$(this).data("placement")||"bottom",$(zero.htmlBridge).tooltip({title:gon.clipboard.click,placement:placement})})}),$.subscribe("deposit_address:create",function(event,data){var code;return code=data?data:$("#deposit_address").html(),$("#qrcode").attr("data-text",code),$("#qrcode").attr("title",code),$(".qrcode-container").each(function(index,el){var $el;return $el=$(el),$("#qrcode img").remove(),$("#qrcode canvas").remove(),new QRCode(el,{text:$("#qrcode").attr("data-text"),width:$el.data("width"),height:$el.data("height")})})}),$.publish("deposit_address:create"),$.subscribe("flash",function(event,data){return $(".flash-messages").show(),$("#flash-content").html(data.message),setTimeout(function(){return $(".flash-messages").hide(1e3)},1e4)}),$.subscribe("two_factor_init",function(){return TwoFactorAuth.attachTo(".two-factor-auth-container")}),$.publish("two_factor_init")})}.call(this);